<div id="uc_magellan_youtube_playlist_api_elementor18883"></div>

<script>
    function initialize_uc_magellan_youtube_playlist_api_elementor18883() { // ALL YOUTUBE PLAYLIST API WIDGET CODE WRAPPED IN FUNCTION SO ALL VARIABLES ARE LOCALLY SCOPED TO AVOID ERRORS WITH UTILIZING THE WIDGET MORE THAN ONCE ON THE SAME PAGE
  
  // ALL HTML, CSS, JAVASCRIPT CODE FOR THE YOUTUBE PLAYLIST API IS PRESENT HERE, MINUS THE ROOT WIDGET HTML CONTAINER.  A CONTAINER MUST BE PRESENT IN THE HTML WITH THE ID OF THE WIDGET FOR THE "widgetRoot" DOM SELECTOR TO INITIATE THE WIDGET.

  // Variable Declarations

    // Value Declarations.  Elementors Unlimited Elements Widget Creator Inserts User Input Values Into Variables With Curly Bracket Surroundings.

      // Programming Variable Declarations
      
      const apiKey = 'AIzaSyCI7Y5K9XF-l1G0mb7qGNp3vd7-1vm2PrU'; // API Key For Youtube API Through Google Cloud
      const playlistId = 'PLE69e89d5PM1U_JyAV5U-dguNaMQ4yGJm'; // Youtube Playlist Id
      const resultLimitPerRequest = 50; // Youtube API Has A Limit Of 50 Results Per Request.
      const limitVideos = false; // Limit Videos Displayed.  Default Value Is: true
      const maxResults = 6; // If limitVideos Is Set To: true, Limit Number Of Videos Displayed.  Default Value Is: 6
      const filterByName = false; // Filter Video Results Based On Characters In Title.  Default Value Is: false
      const filterNameParameters = ''.toLowerCase(); // If filterByName Is Set To: true, Filter String Parameters For filterByName.  Default Value Is: ''
      let storedPlaylistRetrieved = false; // Determines If Data Was Loaded From Local Storage.  Utilized In getPlaylistItems Function.  Default Staring Value Is: false
      const sortVideosBy = 'number-descending'; // How Video Items Should Be Sorted.  Default Value Is: 'number-descending'
      const listByRange = false; // Show Specific Range Of Videos By Episode Number.  Default Value Is: false
      const fromEpisodeNumber = 1; // If listByRange Is Set To: true, Set Starting Episode Number To Filter From. Default Value Is: 1
      const toEpisodeNumber = 1; // If listByRange Is Set To: true, Set Starting Episode Number To Filter From.  Default Value Is: 1
      const showInformationBelow = false; // Show Text Information About Video Below Video Thumbnail.  Default Value Is: false
      const showNonNumberedEpisodesOnly = false; // Shows Videos That Do Not Have An Episode Number Only. Default Value Is: false 
      const hideNonNumberedVideos = false; // Hides Non-Numbered Videos In Playlist.  Default Value Is: false   
      const timeStorageInterval = 60 * 60000; // Sets Time Interval That Another API Call Request Can Be Made Instead Of Loading From Local Storage In Minutes That Is Multiplied By 60000 To Convert Minutes To Milliseconds.  Default Value is 60
      const instructionMessage = 'Click Here To Watch'; // Instruction Message Text.  Default Value is: 'Click Here To Watch'
      const showPlayButtons = true; // Sets If Play Button Icons Should Be Shown Over Video Thumbnails.  Default Value Is: true
      const showVideoInfo = false; // Sets If Text Information About Video Should Be Displayed Below Video Thumbnail.  Default Value Is: false
      const showDescriptionText = false; // If showVideoInfo Is Set To True, Sets If Video Description Text Should Be Displayed.  Default Value Is: false
      const lightboxDisplayBreakpoint = 1400; // Sets Breakpoint Between LightBox Being Enabled And Opening In Another Tab When Video Thumbnail Is Clicked.  Default Value Is: 1400
      const playlistLayout = 'carousel'; // Determines The Layout Of Videos On Page.
      const showAllInLightbox = false; // Determines If Lightbox Will Allow User To See All Videos On PlayList If True. If False, User Can Only View Videos Shown On Page  
      let playListSorted = []; // Captures All Videos After Filtering And Sorting Before They're Reduced To Output Amount For Showing All Videos When Navigating Through Lightbox
      let pageOutputList = []; // The Actual List Of Video That Will Be Shown On The Page (Grid Or Carousel Layout)
      const lightboxFrameVideoBaseUrl = 'https://www.youtube.com/embed/'; // Video Base Url For Lightbox Video Iframes
      const fastForwardSpeed = 150; // Set The Speed That Frames Should Be Fast Forwarded Through On Carousel And Lightbox When User Holds Down Arrow.
      let lightboxToggled = false // Used To Determine If Lightbox Is Toggled
      
      // CSS Variable Declarations

      const playButtonColor = '#ffffff'; // Sets Color Of Play Button Icon Over Video Thumbnail.  Default Value IS: '#ffffff'
      const gapBetweenVideos = '60px'; // Sets Spacing Between Video Item Containers.  Default Value Is: '48px'
      const videoContainerBorderThickness = '0px'; // Sets Video Container Border Thickness: Default Value Is: '0px'
      const videoContainerBorderColor = '#000000'; // Sets Video Container Border Color: Default Value Is: '#000000'
      const dropShadowValues = '4px 4px 12px'; // Sets Drop-Shadow Values For Video Container.  Default Value Is: 0px 0px 0px
      const dropShadowColor = '#01010147'; // Sets Drop-Shadow Color For Video Container.  Default Value Is: '#00000036'
      const textBelowThumbnailTopBottomMargin = '24px'; // Sets Text Below Video Thumbnail Margins On Top And Bottom. Default Value Is: '24px'
      const textBelowThumbnailSideMargins = '24px'; // Sets Text Below Video Thumbnail Margins On Sides.  Default Value Is: '24px'
      const titleTextColorBelowThumbnail = '#000000'; // Sets Color Of Video Title Text Below Video Thumbnail.  Default Value Is: '#000000'
      const spaceBetweenTitleAndDescriptionBelowThumbnail = '24px'; // Sets Vertical Space Gap Between Title Text And Description Text Below Video Thumbnail.  Default Value Is: '24px'
      const descriptionTextColorBelowThumbnail = '#000000'; // Sets Color Of Description Text Below Video Thumbnail.  Default Value Is: '#000000'
      const imageDarkeningOpacity = '20'; // Sets How Dark The Video Thumbnail Should Get Opacity On Mouse Hover.  Default Value Is: '20'
      const textOverThumbnailColor = '#ffffff'; // Sets Color Of Text Over Video Thumbnail On Mouse Hover.  Default Value Is: '#ffffff'
      const textContainerMargin = '24px'; // Sets Padding Of Text Container That Cover Over Video Thumbnail For Text On Mouse Hover.  Default Value Is: '24px'
      const spaceBetweenTitleAndClickToPlayText = '40px'; // Sets Vertical Spacing Between Episode Number Or Video Title Text And Instruction Text On Mouse Hover Over Thumbnail.  Default Value Is: '40px'
      const playButtonSizing = '35%'; // Sets Sizing Of Play Button Icon Over Video Thumbnail Relative To The HEight Of The Video Thumbnail In Percentage.  Default Value Is: '35%'
      const playButtonOpacity = 75 / 100; // Sets Opacity Of Play Button Icon Over Video Thumbnail.  Divides Number By 100 To Convert Percentage To Decimal. Default Value Is: 75
      const closeButtonSize = '32px'; // Sets Size Of Lighbox Close Button On Top Right Corner Of Screen When Lighbox Is Active.  Default Value Is: '32px'
      const minimumWidthOfEachVideoItem = 480; // Sets Minimun Width Size Of Each Video.  Default Value Is: 480
      const mediaQueryBreakpoint = minimumWidthOfEachVideoItem * 2; // Sets Media Query Break Point Of When Video Containers Should Stack In One Column.  Calculation Based Upon minimumWidthOfEachVideo Number.  Default Value Is: minimumWidthOfEachVideoItem * 2
      const frameTransition = 500; // Sets Transition Time Of LightBox Carousel Frame Transitioning In Milliseconds
      const carouselTransition = 1500; // Sets Transition Time Of Carousel Layout Frame Transitioning In Milliseconds
      const carouselDelay = 6000; // Sets Delay Carousel Layout Between Transitioning In Milliseconds
      const carouselWidth = 32.5 // Set Width Of Carousel Layout Thumbnails In REMs
      const carouselArrowsColor = '#000000' // Sets Color Of Carousel Layout Arrows And Text Overlay During Fast Forward

    // Error Handling Variables

      const apiErrMsg = 'An Error Occured During The Youtube Playlist API Call.  The Same Youtube Playlist Was Found On Local Storage And Has Been Loaded Instead.';
      let failedItemTally = 0; 

    // Initialization Loading Spinner

      const loadingSpinner = `<svg version="1.1" id="L7" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve"
            class="loading-spinner">
         <path fill="#fff" d="M31.6,3.5C5.9,13.6-6.6,42.7,3.5,68.4c10.1,25.7,39.2,38.3,64.9,28.1l-3.1-7.9c-21.3,8.4-45.4-2-53.8-23.3
          c-8.4-21.3,2-45.4,23.3-53.8L31.6,3.5z">
              <animateTransform attributeName="transform" attributeType="XML" type="rotate" dur="2s" from="0 50 50" to="360 50 50" repeatCount="indefinite"></animateTransform>
          </path>
         <path fill="#fff" d="M42.3,39.6c5.7-4.3,13.9-3.1,18.1,2.7c4.3,5.7,3.1,13.9-2.7,18.1l4.1,5.5c8.8-6.5,10.6-19,4.1-27.7
          c-6.5-8.8-19-10.6-27.7-4.1L42.3,39.6z">
              <animateTransform attributeName="transform" attributeType="XML" type="rotate" dur="1s" from="0 50 50" to="-360 50 50" repeatCount="indefinite"></animateTransform>
          </path>
         <path fill="#fff" d="M82,35.7C74.1,18,53.4,10.1,35.7,18S10.1,46.6,18,64.3l7.6-3.4c-6-13.5,0-29.3,13.5-35.3s29.3,0,35.3,13.5
          L82,35.7z">
              <animateTransform attributeName="transform" attributeType="XML" type="rotate" dur="2s" from="0 50 50" to="360 50 50" repeatCount="indefinite"></animateTransform>
          </path>
        </svg>
      `;

    // HTML Base Containers Initialization.  Loading Spinner Is Included On Initialization

      const widgetId = '#uc_magellan_youtube_playlist_api_elementor18883';
      const widgetRoot = document.querySelector(`${widgetId}`);

      widgetRoot.innerHTML = 
        `
          <style class="playlist-styling"></style>
          <div class="video-list">
          	${loadingSpinner}
            <div style="height: 400px; width: 100%;"></div>
		      </div>
      `;

    // Lightbox Container Created And Appended To Body Of HTML

	    const lightboxDiv = document.createElement('div');
      lightboxDiv.dataset.lightboxid = widgetId;
      document.body.appendChild(lightboxDiv);

    // DOM Element Selector Declarations

      const stylesContainer = document.querySelector(`${widgetId} .playlist-styling`)
      const playlistItems = document.querySelector(`${widgetId} .video-list`);
      const lightbox = document.querySelector(`[data-lightboxid="${widgetId}"]`);
      const html = document.querySelector('html');

  // END - Variable Declarations

  // CSS Generation 

    const playlistStyling = `
      ${widgetId} {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      ${widgetId} h2 {
        display: block;
        width: 100vw;
        text-align: center;
        font-size: 1.5rem;
        color: black;
      }
      ${widgetId} h3 {
        margin: 0!important;
      }
      ${widgetId} .grid-layout {
        display: grid;
        gap: ${gapBetweenVideos};
      }
      ${widgetId} .loading-spinner {
		    filter: drop-shadow(2px 4px 6px #00000090);
        position: absolute;
        width: 50vw;
        height: 50vw;
        max-width: 240px;
        max-height: 240px;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }
      ${widgetId} .video-item {
        max-width: 100%;
        text-align: center;
        overflow: hidden;
        border: ${videoContainerBorderThickness} ${videoContainerBorderColor} solid;
        width: 100%;
        height: 100%;
        filter: drop-shadow(${dropShadowValues} ${dropShadowColor});
        animation-name: fade-in;
        animation-duration: 1s;
      }
      @keyframes fade-in {
  		  from { opacity: 0;}
        to { opacity: 1;}
	    }
      ${widgetId} .video-thumbnail-wrapper {
        background: black;
        position: relative;
        cursor: pointer;
        ${!showInformationBelow ? `height: 100%;` : ``}
      }
      ${widgetId} .video-info-text-container {
        padding: ${textBelowThumbnailTopBottomMargin} ${textBelowThumbnailSideMargins};	
      }
      ${widgetId} .video-info-text-container h3 {
        color: ${titleTextColorBelowThumbnail};
        margin-bottom: ${spaceBetweenTitleAndDescriptionBelowThumbnail};
      }
      ${widgetId} .video-info-text-container span {
        color: ${descriptionTextColorBelowThumbnail};
      }
      ${widgetId} .video-thumbnail-wrapper:hover img {
        opacity: calc(${imageDarkeningOpacity} / 100);
      }
      ${widgetId} .video-thumbnail-wrapper:hover svg {
        opacity: 0;
      }
      ${widgetId} .video-thumbnail-wrapper:hover .hover-text-container {
        opacity: 1;
      }
      ${widgetId} .video-thumbnail-wrapper img {
        object-fit: cover;
        width: 100%!important;
        min-width: 100%!important;
        height: 100%!important;
        max-height: 100%!important;
      }
      .video-thumbnail-wrapper img {
        transition: 0.5s;
      }
      ${widgetId} .video-thumbnail-wrapper .hover-text-container {
        font-family: 'Roboto';
        position: absolute;
        width: 100%;
        height: 100%;
        color: ${textOverThumbnailColor};
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: ${textContainerMargin};
        display: flex;
        flex-direction: column;
        justify-content: center;
        opacity: 0;
        transition: 0.5s;
        gap: ${spaceBetweenTitleAndClickToPlayText};
      }
      ${widgetId} .video-thumbnail-wrapper .hover-text-container h3 {
        font-size: 2.5rem;
        font-weight: 600;
      }
      ${widgetId} .video-thumbnail-wrapper .hover-text-container p {
        font-size: 1.75rem;
        font-weight: 400;
      }
      ${widgetId} .video-info-text-container {
        opacity: 1;
      }
      ${widgetId} .video-thumbnail-wrapper .hover-text-container h3 {
        margin: 0
      }
      ${widgetId} .video-thumbnail-wrapper .hover-text-container p {
        margin: 0
      }
      ${widgetId} .video-thumbnail-wrapper svg {
        position: absolute;
        transition: 0.5s;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 2;
        width: ${playButtonSizing};
        height: ${playButtonSizing};
        opacity: ${playButtonOpacity};
      }
      .show-lightbox {
        display: block!important;
      }
      .hide-scroll {
        overflow: hidden!important;
      }
      .hide-header {
        display: none!important;
      }
      .frame-transition-left {
        transform: translateX(-60%) rotateY(90deg) scale(0);
        opacity: 0;
        pointer-events: none !important;
      }
      .frame-transition-right {
        transform: translateX(60%) rotateY(-90deg) scale(0);
        opacity: 0;
        pointer-events: none !important;
      }
      .carousel-arrow-hold {
        animation-iteration-count: infinite;
        animation-duration: ${fastForwardSpeed / 1000}s;
        animation-name: carousel-fast-forward;
      }
      @keyframes carousel-fast-forward {
        from { filter: drop-shadow(0px 0px 0px ${carouselArrowsColor}) }
        to { filter: drop-shadow(24px 0px 0px ${carouselArrowsColor}) }
      }
      .disable-arrow {
        opacity: 0;
        pointer-events: none !important;
      }
      .element-invisible {
        opacity: 0 !important;
        z-index: -1 !important;
      }
      .carousel-fast-forward-transitioning {
        opacity: 0.1 !important;
        z-index: -1 !important;
      }
      .carousel-fast-forward-transitioning a {
        transition: 0.05s !important;
      }
      .carousel-fast-forward-transitioning a svg {
        opacity: 0 !important;
      }
      .fast-forward-overlay {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        position: absolute;
      }
      [data-lightboxid="${widgetId}"] {
        width: 100%;
        height: 100vh;
        display: none;
        background: #000000E2;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 100000;
      }
      [data-lightboxid="${widgetId}"] .lightbox-content-container {
        width: 100%;
        height: 100%;
        margin: 0 auto;
        max-width: 1920px;
        box-sizing: border-box;
        padding: 40px 2%;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      [data-lightboxid="${widgetId}"] .lightbox-close-button {
        color: white;
        position: fixed;
        top: 24px;
        left: calc(100% - 24px);
        transform: translateX(-100%);
        font-family: 'Ruda', sans-serif;
        font-weight: 700;
        font-style: normal;
        font-size: ${closeButtonSize};
        cursor: pointer;
        border: calc(${closeButtonSize} / 6.667) white solid;
        border-radius: 50%;
        width: calc(${closeButtonSize} * 1.54);
        height: calc(${closeButtonSize} * 1.54);
        display: flex;
        justify-content: center;
        align-items: center;
        transition: 0.25s;
      }
      [data-lightboxid="${widgetId}"] .lightbox-close-button:hover {
        transform: translateX(-100%) scale(1.25);
      }
      [data-lightboxid="${widgetId}"] svg {
        max-width: 60px;
        min-width: 2%;
        height: 100px;
        cursor: pointer;
        z-index: 3;
        transition: 0.25s;
      }
      [data-lightboxid="${widgetId}"] .lightbox-video-container {
        width: 78vw!important;
        height: 43.9vw!important;
        max-height: 90vh!important;
        max-width: 160vh!important;
        position: relative;
      }
      .arrow-left {
        cursor: pointer;
      }
      .arrow-left:hover {
        transform: scale(1.25);
        transition: 0.25s;
      }
      .arrow-right {
        cursor: pointer;
        transform: rotate(180deg);
      }
      .arrow-right:hover {
        transform: scale(1.25) rotate(180deg);
        transition: 0.25s;
      }
      .arrow-left:active {
        transform: translate(-10%);
        transition: 0.1s;
      }
      .arrow-right:active {
        transform: translate(10%) rotate(180deg);
        transition: 0.1s;
      }
      .carousel-fast-transition {
        transition: ${frameTransition / 1000}s !important;
      }
      .carousel-zero-transition a {
        transition: 0.05s !important;
      }
      [data-lightboxid="${widgetId}"] iframe {
        width: 100%;
        height: 100%;
        border: 0px;
        position: absolute;
        box-shadow: 0px 0px 48px black;
        filter: drop-shadow(rgba(255, 255, 255, 0.44) 0px 0px 80px);
        transition: ${frameTransition / 1000}s !important;
        z-index: 10;
      }
      ${widgetId} .carousel-layout {
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
      }
      ${widgetId} .carousel-layout [data-carouselarrow="true"] g,
      ${widgetId} .carousel-layout [data-fastforwardoverlay="true"] h1
      {
        fill: ${carouselArrowsColor};
        color: ${carouselArrowsColor};
      }
      ${widgetId} .carousel-layout a {
        position: absolute;
        transition: ${carouselTransition / 1000}s;
      }
      ${widgetId} [data-carouselarrow="true"] {
        width: 48px;
      }
      ${widgetId} .carousel-layout .carousel-video-frame {
        position: relative;
        height: ${carouselWidth / 1.777}rem;
        width: ${carouselWidth}rem;
        margin: 0 3%;
      }
      @media(max-width: ${mediaQueryBreakpoint}px) {
        ${widgetId} .grid-layout {
          grid-template-columns: 1fr;
        }
      }
      @media(min-width: ${mediaQueryBreakpoint + 1}px) {
        ${widgetId} .grid-layout {
          grid-template-columns: repeat(auto-fill, minmax(${minimumWidthOfEachVideoItem}px, 1fr));
          grid-auto-rows: 1fr;
        }
      }
      @media(max-width: ${carouselWidth * 20}px) {
        ${widgetId} .carousel-layout .carousel-video-frame {
          width: 72vw;
          height: calc(72vw / 1.777);
        }
        ${widgetId} .carousel-layout .carousel-video-frame .hover-text-container {
          gap: 7vw;
        }
        ${widgetId} .carousel-layout .carousel-video-frame h3 {
          font-size: 8vw;
        }
        ${widgetId} .carousel-layout .carousel-video-frame p {
          font-size: 5vw;
        }
      }
    `
    stylesContainer.innerHTML = playlistStyling;

  // END - CSS Generation

  // Set Thumbail Images For Grid Layout And Carousel Items

    function setThumbnailImage(item) {
      const thumbnails = item.snippet.thumbnails;
      const image = thumbnails.maxres ? thumbnails.maxres : thumbnails.standard ? thumbnails.standard : thumbnails.high ? thumbnails.high : thumbnails.medium ? thumbnails.medium : thumbnails.default;
      return image
    }

  // Set Thumbnail Episode Number Or Title Text

    function setThumbnailText(item) {
      const { snippet } = item;
      return item.titledEpisode !== -1 ? `<h3>Episode ${item.titledEpisode}</h3>` : `<h3>${snippet.title}</h3>`
    }

  // HTML Generation Methods

    // Lightbox HTML

    const lightboxHTML = `
      <div class="lightbox-content-container">
        <svg version="1.0" xmlns="http://www.w3.org/2000/svg" class="arrow-left" data-hideonidle="true" data-lightboxarrowdirection="left" data-lightboxarrow="true"
          width="100.000000pt" height="100.000000pt" viewBox="0 0 100.000000 100.000000"
          preserveAspectRatio="xMidYMid meet">
          <g data-hideonidle="true" transform="translate(0.000000,100.000000) scale(0.100000,-0.100000)"
          fill="#ffffff" stroke="none">
          <path data-hideonidle="true" d="M415 720 l-220 -220 223 -222 222 -223 72 73 73 72 -148 148 -147 147 145 145 c80 80 145 149 145 155 0 0 -140 145 -140 145 0 0 -104 -99 -225 -220z"/>
          </g>
        </svg>
        <div class="lightbox-video-container">
          <iframe data-frameposition="-1" class="frame-transition-left" width="560" height="315" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
          </iframe>
          <iframe data-frameposition="0" width="560" height="315" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
          </iframe>
          <iframe data-frameposition="1" class="frame-transition-right" width="560" height="315" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
          </iframe>
        </div>
        <svg version="1.0" xmlns="http://www.w3.org/2000/svg" class="arrow-right" data-hideonidle="true" data-lightboxarrowdirection="right" data-lightboxarrow="true"
          width="100.000000pt" height="100.000000pt" viewBox="0 0 100.000000 100.000000"
          preserveAspectRatio="xMidYMid meet">
          <g data-hideonidle="true" transform="translate(0.000000,100.000000) scale(0.100000,-0.100000)"
          fill="#ffffff" stroke="none">
          <path data-hideonidle="true" d="M415 720 l-220 -220 223 -222 222 -223 72 73 73 72 -148 148 -147 147 145 145 c80 80 145 149 145 155 0 0 -140 145 -140 145 0 0 -104 -99 -225 -220z"/>
          </g>
        </svg>
      </div>
      <div class="lightbox-close-button" data-hideonidle="true" data-lightboxclosebutton="true">X</div>
      `;

    // Carousel Layout HTML

      const carouselHTML = `
        <div class="carousel-layout">
          <svg version="1.0" xmlns="http://www.w3.org/2000/svg" class="arrow-left" data-hideonidle="true" data-carouselarrowdirection="left" data-carouselarrow="true"
            width="100.000000pt" height="100.000000pt" viewBox="0 0 100.000000 100.000000"
            preserveAspectRatio="xMidYMid meet">
            <g data-hideonidle="true" transform="translate(0.000000,100.000000) scale(0.100000,-0.100000)"
            fill="#ffffff" stroke="none">
            <path data-hideonidle="true" d="M415 720 l-220 -220 223 -222 222 -223 72 73 73 72 -148 148 -147 147 145 145 c80 80 145 149 145 155 0 0 -140 145 -140 145 0 0 -104 -99 -225 -220z"/>
            </g>
          </svg>
          <div class="carousel-video-frame">
            <div class="carousel-video-items" data-carouselvideoitems="true">
              <a class="video-item frame-transition-left video-thumbnail-wrapper" data-itemclickable="true" data-frameposition="-1" class="frame-transition-left">
                <img src="" width="" height="" alt="">
                ${showPlayButtons ? playButtonIcon() : ''}
                <div class="hover-text-container">
                  <h3></h3>
                  ${instructionMessage === '' ? '' : `<p>${instructionMessage}</p>`}
                </div>
              </a>
              <a class="video-item video-thumbnail-wrapper" data-itemclickable="true" data-frameposition="0">
                <img src="" width="" height="" alt="">
                ${showPlayButtons ? playButtonIcon() : ''}
                <div class="hover-text-container">
                  <h3></h3>
                  ${instructionMessage === '' ? '' : `<p>${instructionMessage}</p>`}
                </div>
              </a>
              <a class="video-item frame-transition-right video-thumbnail-wrapper" data-itemclickable="true" data-frameposition="1" class="frame-transition-right">
                <img src="" width="" height="" alt="">
                ${showPlayButtons ? playButtonIcon() : ''}
                <div class="hover-text-container">
                  <h3></h3>
                  ${instructionMessage === '' ? '' : `<p>${instructionMessage}</p>`}
                </div>
              </a>
            </div>
            <div class="fast-forward-overlay element-invisible" data-fastforwardoverlay="true">
              <h1></h1>
            </div>
          </div>
            <svg version="1.0" xmlns="http://www.w3.org/2000/svg" class="arrow-right" data-hideonidle="true" data-carouselarrowdirection="right" data-carouselarrow="true"
              width="100.000000pt" height="100.000000pt" viewBox="0 0 100.000000 100.000000"
              preserveAspectRatio="xMidYMid meet">
              <g data-hideonidle="true" transform="translate(0.000000,100.000000) scale(0.100000,-0.100000)"
              fill="#ffffff" stroke="none">
              <path data-hideonidle="true" d="M415 720 l-220 -220 223 -222 222 -223 72 73 73 72 -148 148 -147 147 145 145 c80 80 145 149 145 155 0 0 -140 145 -140 145 0 0 -104 -99 -225 -220z"/>
              </g>
            </svg>
        </div>
      `;

    // Video Item Play Button Icon HTML

    function playButtonIcon() {
      const playbackButton = `
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 1000 1000" enable-background="new 0 0 1000 1000" xml:space="preserve">
        <metadata> Svg Vector Icons : http://www.onlinewebfonts.com/icon </metadata>
        <g><path d="M500,10C229.4,10,10,229.4,10,500c0,270.6,219.4,490,490,490c270.6,0,490-219.4,490-490C990,229.4,770.6,10,500,10z M691.7,538.7L398.6,772.9c-20.7,16.5-37.5,7.5-37.5-20.2V249.7c0-27.7,16.8-36.7,37.5-20.1l293.1,234.3C717.6,484.5,717.6,518,691.7,538.7z" style="
        fill: ${playButtonColor};
        "/></g>
      </svg>
    `
      return playbackButton
    }

    // Grid Layout Video Item HTML

    function renderGridItem(item) {
      const { snippet } = item;
      const image = setThumbnailImage(item);
      const htmlRender = 
        `
          <!-- ${snippet.title} -->
          <a class="video-item" data-itemclickable="true" data-videoid="${snippet.resourceId.videoId}">
            <div class="video-thumbnail-wrapper">
              <img src="${image.url}" width="${image.width}" height="${image.height}" alt="${snippet.title}">
              ${showPlayButtons ? playButtonIcon() : ''}
              <div class="hover-text-container">
                ${setThumbnailText(item)}
                ${instructionMessage === '' ? '' : `<p>${instructionMessage}</p>`}
              </div>
            </div>
            ${ showVideoInfo ? 
              `<div class="video-info-text-container">
                    ${item.titledEpisode !== -1 ? `<h3>Episode ${item.titledEpisode}</h3>` : `<h3>${snippet.title}</h3>`}
                ${snippet.description !== '' && showDescriptionText ? `<span>${snippet.description}</span>` : ''}
              </div>`
              : ''
            } 
          </a>
        `;
      return htmlRender
    }

  // Event Methods

    function setCarouselThumbnail(element, item) {
      element.querySelector('img').src = setThumbnailImage(item).url;
      element.querySelector('img').width = setThumbnailImage(item).width;
      element.querySelector('img').height = setThumbnailImage(item).height;
      element.querySelector('h3').innerHTML = setThumbnailText(item);
      element.dataset.videoid = item.snippet.resourceId.videoId;
    }

  // Carousel Layout Video Event Handling

    function carouselEventHandling() {

      // Select DOM Elements

      const carouselContainer = document.querySelector(`${widgetId} .carousel-layout`);
      const carouselFramesContainer = carouselContainer.querySelector('[data-carouselvideoitems="true"]');
      const carouselFastForwardOverlay = carouselContainer.querySelector('[data-fastforwardoverlay="true"]');
      const carouselFastForwardText = carouselFastForwardOverlay.querySelector('h1');
      const carouselArrowLeft = carouselContainer.querySelector(`[data-carouselarrowdirection="left"]`);
      const carouselArrowRight = carouselContainer.querySelector(`[data-carouselarrowdirection="right"]`);
      const carouselArrows = [carouselArrowLeft, carouselArrowRight];
      const startingCarouselFrame = carouselContainer.querySelector('[data-frameposition="0"]');
      const leftCarouselFrame = carouselContainer.querySelector('[data-frameposition="-1"]');
      const rightCarouselFrame = carouselContainer.querySelector('[data-frameposition="1"]');
      const carouselFrames = carouselContainer.querySelectorAll('.video-item');
      
      // Video Index Start

      let currentVideoIndex = 0;

      // Initialize Carousel Frame Images

      // Starting Frame

      setCarouselThumbnail(startingCarouselFrame, playListSorted[currentVideoIndex]);

      // Left Frame

      setCarouselThumbnail(leftCarouselFrame, playListSorted[playListSorted.length - 1]);

      // Right Frame

      setCarouselThumbnail(rightCarouselFrame, playListSorted[currentVideoIndex + 1] ? 
        playListSorted[currentVideoIndex + 1] : playListSorted[currentVideoIndex]
      );

      // Records When Last Time Carousel Was Advanced To Avoid User Click/Auto Interval Conflict

      let lastTimeAdvanced = new Date().getTime();

      // Fast Forward Handling

      function toggleFastForward(enabled, item) {
        if (enabled) {
          carouselFastForwardOverlay.classList.remove('element-invisible');
          carouselFramesContainer.classList.add('carousel-fast-forward-transitioning');
          carouselFastForwardText.innerHTML = setThumbnailText(item);
        } else {
          carouselFastForwardText.innerHTML = '';
          carouselFastForwardOverlay.classList.add('element-invisible');
          carouselFramesContainer.classList.remove('carousel-fast-forward-transitioning');
        }
      }

      // Left Arrow Click/Mousedown Event Handling

      function advanceCarouselLeft(transitionType, fastForward) {
        if (playListSorted[currentVideoIndex - 1]) {
          currentVideoIndex -= 1;
        } else currentVideoIndex = playListSorted.length - 1

        if (fastForward && mouseDown) {
          toggleFastForward(true, playListSorted[currentVideoIndex]);
        } else toggleFastForward()

        carouselFrames.forEach(frame => 
          frameTransitionHandler(frame, 'left', 'carousel', currentVideoIndex)
        );
      }

      // Right Arrow Click/Mousedown And Auto Transitioning 

      function advanceCarouselRight(transitionType, fastForward) {
        if (playListSorted[currentVideoIndex + 1]) {
          currentVideoIndex += 1;
        } else currentVideoIndex = 0;

        if (fastForward && mouseDown) {
          toggleFastForward(true, playListSorted[currentVideoIndex]);
        } else toggleFastForward()

        carouselFrames.forEach(frame => 
          frameTransitionHandler(frame, 'right', 'carousel', currentVideoIndex, transitionType)
        );
      }

      // Left Arrow Click Event Listener

      carouselArrowLeft.addEventListener('click', () => {
        if (!mouseDown) {
          lastTimeAdvanced = new Date().getTime();
          advanceCarouselLeft()
        } else {
          clearInterval(mouseDownInterval);
          mouseDown = false;
        }
      });

      // Right Arrow Click Event Listener

      carouselArrowRight.addEventListener('click', () => {
        if (!mouseDown) {
          lastTimeAdvanced = new Date().getTime();
          advanceCarouselRight()
        } else {
          clearInterval(mouseDownInterval);
          mouseDown = false;
        }
      });

      // Mouse Hold Speed Through Carousel Frames Event Handling.  Variables For Checking For Mouse Down And Running Repeat Interval

      let mouseDownInterval;
      let mouseDown = false;

      // Left Arrow Mouse Down Event Handler

      carouselArrowLeft.addEventListener('mousedown', () => { 
        mouseDown = true;
          setTimeout(() => {
            if (mouseDown) {
              mouseDownInterval = setInterval(() => {
                if (mouseDown) {
                  advanceCarouselLeft(null, true), fastForwardSpeed;
                }
              }, fastForwardSpeed);
              carouselArrowLeft.classList.add('carousel-arrow-hold');
            }
          }, 500)
      })

      // Right Arrow Mouse Down Event Handler

      carouselArrowRight.addEventListener('mousedown', () => { 
        mouseDown = true;
          setTimeout(() => {
            if (mouseDown) {
              mouseDownInterval = setInterval(() => {
                if (mouseDown) {
                  advanceCarouselRight(null, true), fastForwardSpeed;
                }
              }, fastForwardSpeed);
              carouselArrowRight.classList.add('carousel-arrow-hold');
            }
          }, 500)
      })

      // Arrow Mouse Up Event Handling

      window.addEventListener('mouseup', () => {
        mouseDown = false;
        clearInterval(mouseDownInterval);
        mouseDownInterval = '';
        carouselArrowLeft.classList.remove('carousel-arrow-hold');
        carouselArrowRight.classList.remove('carousel-arrow-hold');
        toggleFastForward();
        setTimeout(() => clearInterval(mouseDownInterval), 50);
      })

      // Automatic Advance Right Interval Handler.  Checks That User Hasn't Advanced The Carousel Via Clicking The Arrows During The carouselDelay Time Period

      setInterval(() => {
        if (new Date().getTime() - lastTimeAdvanced > carouselDelay * 0.5 && !lightboxToggled) {
          advanceCarouselRight('carouselAutomated')
        }
      }, carouselDelay);

    }

    function lightboxClear() {
      lightbox.innerHTML = '';
      lightboxToggled = false;
      lightbox.classList.remove('show-lightbox');
      html.classList.remove('hide-scroll');
    }

    function escapeKeyListener(e) {
      if(e.key === 'Escape') {
        lightboxClear();
      }
    }

    // Lightbox and Carousel Arrow Click Event Handlers

    function frameTransitionHandler(frame, direction, type, currentVideoIndex, transitionType) {
      const transitionSpeed = type === 'lightbox' ? frameTransition : transitionType === 'carouselAutomated' ? carouselTransition
        : type === 'carousel' && transitionType !== 'carouselAutomated' ? frameTransition : frameTransition

      if (type === 'carousel' && transitionType !== 'carouselAutomated') {
        frame.classList.add('carousel-fast-transition');
        setTimeout(() => frame.classList.remove('carousel-fast-transition') ,transitionSpeed)
      }

      switch(frame.dataset.frameposition) {
        case '-1':
          if (direction === 'left') {
            if (type === 'lightbox' && playListSorted[currentVideoIndex] && 
              frame.src !== lightboxFrameVideoBaseUrl + playListSorted[currentVideoIndex].snippet.resourceId.videoId) {
                frame.src = lightboxFrameVideoBaseUrl + playListSorted[currentVideoIndex].snippet.resourceId.videoId
            }
            if (type === 'carousel' && playListSorted[currentVideoIndex]) {
              setCarouselThumbnail(frame, playListSorted[currentVideoIndex])
            }
            frame.classList.remove('frame-transition-left');
            frame.dataset.frameposition = 0;
          }
          if (direction === 'right') {
            frame.classList.remove('frame-transition-left');
            frame.classList.add('frame-transition-right');
            frame.dataset.frameposition = 1;
            setTimeout(() => { 
              if (type === 'lightbox' && playListSorted[currentVideoIndex + 1]) {
                frame.src = lightboxFrameVideoBaseUrl + playListSorted[currentVideoIndex + 1].snippet.resourceId.videoId 
              }
              if (type === 'carousel' && playListSorted[currentVideoIndex + 1]) {
                setCarouselThumbnail(frame, playListSorted[currentVideoIndex + 1])
              }
            }, transitionSpeed)
          }
          break;
        case '0':
          if (direction === 'left') {
            frame.classList.add('frame-transition-right');
            frame.dataset.frameposition = 1;
            setTimeout(() => { 
              if (type === 'lightbox' && playListSorted[currentVideoIndex + 1]) {
                frame.src = lightboxFrameVideoBaseUrl + playListSorted[currentVideoIndex + 1].snippet.resourceId.videoId 
              }
              if (type === 'carousel' && playListSorted[currentVideoIndex + 1]) {
                setCarouselThumbnail(frame, playListSorted[currentVideoIndex + 1])
              }
            }, transitionSpeed)
          }
          if (direction === 'right') { 
            frame.classList.add('frame-transition-left');
            frame.dataset.frameposition = -1;
            setTimeout(() => { 
              if (type === 'lightbox' && playListSorted[currentVideoIndex - 1]) {
                frame.src = lightboxFrameVideoBaseUrl + playListSorted[currentVideoIndex - 1].snippet.resourceId.videoId 
              }
              if (type === 'carousel' && playListSorted[currentVideoIndex + 1]) {
                setCarouselThumbnail(frame, playListSorted[currentVideoIndex + 1])
              }
            }, transitionSpeed)
          }
          break;
        case '1':
          if (direction === 'left') {
            frame.classList.remove('frame-transition-right');
            frame.classList.add('frame-transition-left');
            frame.dataset.frameposition = -1;
            setTimeout(() => { 
              if (type === 'lightbox' && playListSorted[currentVideoIndex - 1]) {
                frame.src = lightboxFrameVideoBaseUrl + playListSorted[currentVideoIndex - 1].snippet.resourceId.videoId 
              }
              if (type === 'carousel' && playListSorted[currentVideoIndex - 1]) {
                setCarouselThumbnail(frame, playListSorted[currentVideoIndex - 1])
              }
            }, transitionSpeed) 
          }
          if (direction === 'right') { 
            if (type === 'lightbox' && playListSorted[currentVideoIndex] && 
              frame.src !== lightboxFrameVideoBaseUrl + playListSorted[currentVideoIndex].snippet.resourceId.videoId) {
                frame.src = lightboxFrameVideoBaseUrl + playListSorted[currentVideoIndex].snippet.resourceId.videoId
            }
            if (type === 'carousel' && playListSorted[currentVideoIndex]) {
              setCarouselThumbnail(frame, playListSorted[currentVideoIndex])
            }
            frame.classList.remove('frame-transition-right');
            frame.dataset.frameposition = 0;
          }
          break;
      }
    }

    // Lightbox Activated Event Handler

    function lightboxActivateHandler(itemClicked) {

      lightboxToggled = true;

      // Select DOM Elements

      lightbox.innerHTML = '';
      lightbox.innerHTML = lightboxHTML;
      const startingLightboxActive = lightbox.querySelector('[data-frameposition="0"]');
      const lightboxStartingLeft = lightbox.querySelector('[data-frameposition="-1"]');
      const lightboxStartingRight = lightbox.querySelector('[data-frameposition="1"]');
      const lightframes = lightbox.querySelectorAll('iframe');
      const lightboxArrowLeft = lightbox.querySelector('[data-lightboxarrowdirection="left"]');
      const lightboxArrowRight = lightbox.querySelector('[data-lightboxarrowdirection="right"]');
      const lightboxCloseButton = lightbox.querySelector('[data-lightboxclosebutton="true"]');

      // Elements To Hide When User Idle In Lightbox After 5 Seconds

      const elementsToHideWhenIdle = [lightboxArrowLeft, lightboxArrowRight, lightboxCloseButton];

      let mouseOverElement = false;
      let lastMouseOverTime = new Date().getTime();
      const idleDelayTime = 5000;

      // Monitors Mouse Movements And Clicks In Lightbox

      function lightboxMouseMoveHandler(e, elementsToHideWhenIdle) {
        mouseOverElement = false;
        lastMouseOverTime = new Date().getTime();
        if (e && e.path) {
          e.path.forEach(p => {
            if (p.dataset && p.dataset.hideonidle) {
              mouseOverElement = true;
            }
          })
        }
        if (e && e.type && !mouseOverElement && e.type === 'click' && !lightboxArrowClicked) {
          lightboxClear();
        }
        if (elementsToHideWhenIdle && elementsToHideWhenIdle[0] !== null && !mouseOverElement) {
          elementsToHideWhenIdle.forEach(element => element.classList.remove('element-invisible'));
          setTimeout(() => {
            if (!mouseOverElement && (new Date().getTime() - lastMouseOverTime) >= idleDelayTime) {
              elementsToHideWhenIdle.forEach(element => element.classList.add('element-invisible'))
            }
          }, idleDelayTime)
        }
      }

      // Calls Upon lightboxMouseMoveHandler Function

      lightboxMouseMoveHandler();

      lightbox.addEventListener('mousemove', e => lightboxMouseMoveHandler(e, elementsToHideWhenIdle));
      lightbox.addEventListener('click', e => lightboxMouseMoveHandler(e, elementsToHideWhenIdle));

      // Video Index And Base Url For Youtube Embed Iframe

      let currentVideoIndex = playListSorted.findIndex(video => video.snippet.resourceId.videoId === itemClicked.dataset.videoid);
      // Check For Starting Position To See If Arrows Should Be Shown Based Upon Starting Video Index Position And Set Corresponding Iframe Urls

      if (!playListSorted[currentVideoIndex + 1]) {
        lightboxArrowRight.classList.add('disable-arrow');
      } else lightboxStartingRight.src = lightboxFrameVideoBaseUrl + playListSorted[currentVideoIndex + 1].snippet.resourceId.videoId;
      if (!playListSorted[currentVideoIndex - 1]) {
        lightboxArrowLeft.classList.add('disable-arrow');
      } else lightboxStartingLeft.src = lightboxFrameVideoBaseUrl + playListSorted[currentVideoIndex - 1].snippet.resourceId.videoId;

      // Check If Video Index Has Video And Check For Browser Window Width And Set For Lightbox Or Full Screen Iframe On Mobile, Tablet

      if (playListSorted[currentVideoIndex]) {
        if (window.innerWidth > lightboxDisplayBreakpoint) {
          startingLightboxActive.src = lightboxFrameVideoBaseUrl + playListSorted[currentVideoIndex].snippet.resourceId.videoId;
        } else window.open(lightboxFrameVideoBaseUrl + playListSorted[currentVideoIndex].snippet.resourceId.videoId)
      }
      if (window.innerWidth > lightboxDisplayBreakpoint) {
        startingLightboxActive.contentDocument.body.addEventListener('keyup', escapeKeyListener);
        lightbox.classList.toggle('show-lightbox');
        html.classList.toggle('hide-scroll');
      } else {
        lightboxClear();
      }      

      // Event Listener On Exit Button Click To Exit LightBox

      lightboxCloseButton.addEventListener('click', lightboxClear);

      // Checks If Lightbox Arrow Was Clicked

      let lightboxArrowClicked = false;

      // Set lightboxArrowClicked To True For 500 Milliseconds Then Changed Back To False

      function setLightboxArrowClicked() {
        lightboxArrowClicked = true;
        setTimeout(() => {
          lightboxArrowClicked = false;
        }, 250)
      }

      // Event Listeners For Left And Right Lightbox Arrows

      // Left Arrow Click Event Listener

      lightboxArrowLeft.addEventListener('click', () => {
        setLightboxArrowClicked();
        currentVideoIndex -= 1;

        if (playListSorted[currentVideoIndex - 1]) {
          lightboxArrowLeft.classList.remove('disable-arrow');
        } else lightboxArrowLeft.classList.add('disable-arrow');

        if (playListSorted[currentVideoIndex + 1]) {
          lightboxArrowRight.classList.remove('disable-arrow')
        } else lightboxArrowRight.classList.add('disable-arrow')

        lightframes.forEach(frame => frameTransitionHandler(frame, 'left', 'lightbox', currentVideoIndex));
      });

      // Right Arrow Click Event Listener

      lightboxArrowRight.addEventListener('click', () => {
        setLightboxArrowClicked();
        currentVideoIndex += 1;

        if (playListSorted[currentVideoIndex + 1]) {
          lightboxArrowRight.classList.remove('disable-arrow');
        } else lightboxArrowRight.classList.add('disable-arrow');

        if (playListSorted[currentVideoIndex - 1]) {
          lightboxArrowLeft.classList.remove('disable-arrow');
        } else lightboxArrowLeft.classList.add('disable-arrow');

        lightframes.forEach(frame => frameTransitionHandler(frame, 'right', 'lightbox', currentVideoIndex));
      });
    }

  // Data Retrieval From LocalStorage / API Method

    async function getPlaylistItems() {

      // Local Storage Check And Retrieval If Found.  If Found, Checks Timing So That The Current Time Minus The Stored Time Do Not Exceed timeStorageInterval Declaration

      let storedPlaylists = localStorage.getItem('youtubePlaylists');
      let storedPlaylistId;
      if (storedPlaylists) {
        storedPlaylists = JSON.parse(storedPlaylists)
        const currentTime = new Date().getTime();
        storedPlaylistId = storedPlaylists.find(list => list.items[0].snippet.playlistId === playlistId);
        if (storedPlaylistId) {
          if (currentTime - storedPlaylistId.storedTime < timeStorageInterval) {
              storedPlaylistRetrieved = true;
              return { data: storedPlaylistId, ok: true }
          }
        }
      } 

      // API Fetch If Local Storage Data Not Found Or If Local Storage Data Found And Time Stored Exceeded timeStorageInterval Declaration

      if (!storedPlaylistRetrieved){
        const baseUrl = `https://youtube.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=`;
        const fullPath = `${baseUrl}${playlistId}&key=${apiKey}&maxResults=1000`;
        try {
          const res = await fetch(fullPath);
          if (res.ok) {
            let data = await res.json();

            // Youtube API Has A Limit Of Results Per Request Based Upon resultLimitPerRequest Declaration.  If Total Results In Playlist Exceeds This, Multiple Requests Are Made To The Youtube API Until Total Results Retrieved Equals Total In Playlist.

            if (data.pageInfo.totalResults > resultLimitPerRequest) {
              let nextPageToken = data.nextPageToken;
              for (let totalVideos = data.items.length; totalVideos < data.pageInfo.totalResults; totalVideos) {
                const nextPageTokenPath = fullPath + `&pageToken=${nextPageToken}`;
                const page = await fetch(nextPageTokenPath);
                if (res.ok) {
                  const pageData = await page.json();
                  data.items = [...data.items, ...pageData.items];
                  data.pageInfo.resultsPerPage += pageData.items.length;
                  if (pageData.nextPageToken) {
                    nextPageToken = pageData.nextPageToken
                  }
                  totalVideos += pageData.items.length
                } else {
                  console.error(`There Was An Error Attempting To Load Additional Pages Of Videos.  Total Videos Displayed May Be Less Than The Max Results Or Total On Playlist`);
                  break;
                }
              }
            }

            // Data Retrieved From API Saved / Updated In Local Storage

            data.storedTime = new Date().getTime();
            if (storedPlaylists) {
                let revisedStoredPlaylists;
                if (storedPlaylistId) {
                  revisedStoredPlaylists = storedPlaylists.map(list => {
                      if (list.items[0].snippet.playlistId === playlistId) {
                          return data
                      } else return list
                  });
                } else revisedStoredPlaylists = [...storedPlaylists, data]
                localStorage.removeItem('youtubePlaylists');
                localStorage.setItem('youtubePlaylists', JSON.stringify(revisedStoredPlaylists));
            } else {
                localStorage.setItem('youtubePlaylists', JSON.stringify([data]));
            }
            return { status: res.status, ok: true, data }

          // Error Handling If res.ok Is False

          } else {
            console.error(`Server responded with a ${res.status}.`);
            if (storedPlaylistId) {
              console.warn(apiErrMsg);
              return { data: storedPlaylistId, ok: true }
            } else return { status: res.status, ok: false }
          }

        // Error Handling If Connection To API Fails

        } catch(err) {
          console.error(err);
          if (storedPlaylistId) {
              console.warn(apiErrMsg)
              return { data: storedPlaylistId, ok: true }
          } else return { status: res.status, ok: false }
        }
      }
    }

  // Data List Management Methods

    // Data List Sorting

    function listSorter(a, b) {
      switch (sortVideosBy) {
        case 'position-descending':
          return a.snippet.position < b.snippet.position ? -1 : 1;
        case 'position-ascending':
          return a.snippet.position < b.snippet.position ? 1 : -1;
        case 'number-descending':
          return a.titledEpisode < b.titledEpisode ? 1 : -1;
        case 'number-ascending':
          return a.titledEpisode < b.titledEpisode ? -1 : 1;
        case 'date-descending':
          return a.snippet.publishedAt < b.snippet.publishedAt ? 1 : -1;
        case 'date-ascending':
          return a.snippet.publishedAt < b.snippet.publishedAt ? -1 : 1;
      }
    }

    // Episode Number Assigning

    function numberReducer(input) {
      let finalResult;
      function hasNumber(numCheck) {
        return numCheck.search(/[0-9]/) > -1 ? numCheck.search(/[0-9]/) : -1;
      }
      const hasOneDigit = hasNumber(input);
      if (hasOneDigit > -1) {
        input = input.slice(input.search(/[0-9]/));
        finalResult = input[0];
        for (let i = 1; hasNumber(input.slice(i)) > -1; i++) {
          finalResult += input[i] 
        }
        return Number(finalResult)
      } else return -1
    }

  // END - Data List Management Methods

  // CONTROLLER - Initialization For Data Retrieval, Data Management, HTML Render, And Event Listener Initializations

    getPlaylistItems().then(res => {
        if (res.ok) {
          pageOutputList = [...res.data.items];

          // Filter By Name

          if (!pageOutputList[0].snippet) {
            console.warn('Failed To Load Playlist Due To Lack Of Sufficient Data.  Playlist May Be Empty');
            playlistItems.innerHTML = `
              <h2>The Playlist Is Currently Empty.</h2>
            `
            return
          }

          if (filterByName) {
              pageOutputList = pageOutputList.filter(item => item.snippet.title.toLowerCase().includes(filterNameParameters));
          }  
          // Sorting 

          pageOutputList = pageOutputList.map(item => ({...item, titledEpisode: numberReducer(item.snippet.title)}));
          for (let i = 0; i < 2; i++) {
              pageOutputList.sort((a, b) => listSorter(a, b));
          }

          // Removes Duplicates If Found 

          pageOutputList = pageOutputList.filter((item, index) => {
            if (pageOutputList[index + 1]) {
              return pageOutputList[index + 1].titledEpisode !== item.titledEpisode ? true : false;
            } else return true
          });

          // Filter By Episode Range If listByRange Is True

          if (listByRange) {
            pageOutputList = pageOutputList.filter(item => item.titledEpisode >= fromEpisodeNumber && item.titledEpisode <= toEpisodeNumber);
          }

          // Filter Out Numbered Episodes Only Non Numbered Episodes Are Shown If showNonNumberedEpisodesOnly Is True

          if (showNonNumberedEpisodesOnly) {
              pageOutputList = pageOutputList.filter(item => item.titledEpisode === - 1);
          }

          // Filter Out Non Numbered Episodes If hideNonNumberedVideos Is True

          if (hideNonNumberedVideos) {
              pageOutputList = pageOutputList.filter(item => item.titledEpisode !== - 1);
          }

          // Capture All Videos After Filtering And Sorting Before Quantity For Output Is Reduced If showAllInLightbox Is True To Show All Videos In Lightbox

          if (showAllInLightbox) {
            playListSorted = [...pageOutputList];
          }

          // Reduces Amount Of Video Thumbnails To Be Displayed On Page

          if (maxResults < pageOutputList.length && limitVideos) {
              pageOutputList = pageOutputList.filter((item, index) => (index + 1) <= maxResults);
          }

          // Make playListSorted Show The Same as pageOutputList if showAllInLightbox Is False

          if (!showAllInLightbox) {
            playListSorted = [...pageOutputList];
          }

          // HTML Rendering

          // Grid Layout Rendering

          if (playlistLayout === 'grid') {
            const gridListMapping = pageOutputList.map(item => {
              if (!item) {
                console.error(`Playlist VideoID: ${item.snippet.resourceId.videoId} Failed To Load`);
                failedItemTally++
              } else if (!item.snippet || !item.titledEpisode) {
                console.warn('Failed To Load Playlist Item Due To Lack Of Sufficient Data.  Playlist Could Possibly Be Empty')
              } else if (item.snippet.title.toLowerCase() === 'deleted video' || item.snippet.title.toLowerCase() === 'private video') {
                console.warn(`Video Playlist Item ${item.snippet.resourceId.videoId} Could Not Be Loaded As Its Status Is: ${item.snippet.title}`);
              } else return renderGridItem(item);
            }).join('');       
            playlistItems.outerHTML = '<div class="grid-layout">' + gridListMapping + '<div>';
          }

          // Carousel Layout Rendering

          if (playlistLayout === 'carousel') {
            playlistItems.outerHTML = carouselHTML;
            carouselEventHandling();
          }

          // Error Logging

          if (failedItemTally > 0) {
              console.error(`${failedItemTally} Playlist Items Failed To Load.`)
          }

          // Click Event Listener Initialization After HTML Rendering Of Video Items

          const items = document.querySelectorAll(`${widgetId} [data-itemclickable="true"]`);
          items.forEach(item => {
            item.addEventListener('click', () => lightboxActivateHandler(item));
          });

          // Escape Key And Click Event Listener Initialization For Lightbox

          window.addEventListener('keyup', escapeKeyListener);
          // lightbox.addEventListener('click', (e) => lightboxActivateHandler(lightbox, e));

      } else {

        // Error Message If Data Failed To Load

        playlistItems.innerHTML = `
          <h2>There was an error loading the Youtube playlist. Try refreshing the browser.</h2>
        `
      }
    });

  // END CONTROLLER
}

initialize_uc_magellan_youtube_playlist_api_elementor18883();
</script>
